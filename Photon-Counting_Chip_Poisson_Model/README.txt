
============================================================
    Photon-Counting ASIC Model (Poisson-based)
    基于泊松的光子计数 ASIC 模型
============================================================
这是一个面向光子计数探测器（Photon Counting Detector, PCD）
前端芯片的物理模型工具。

核心思想：
- 光子到达服从泊松过程
- 显式模拟芯片前端（电荷积分、整形、DAC噪声）
- 通过多阈值扫描重建能谱

适合用途：
- 理解光子计数器的运行机制 
- pile-up 行为研究
- 不同滤片 / 管压条件下的芯片响应分析
- 能谱标定方法验证


------------------------------------------------------------
【重要的文件】
------------------------------------------------------------

run_pc_chip_pcm.py
    主入口脚本，直接运行即可。
    负责：
    - 读取配置
    - 调度仿真
    - 管理结果输出

poisson_signal_generator_utils.py
    物理模型核心文件。
    包含：
    - 泊松光子到达
    - 积分节点电压模型
    - CR-RC 整形
    - 阈值计数
    - 波形 / 能谱相关绘图

configs/gd_demo.yaml
    参数配置文件（可根据实际需要进行参数修改）。 


------------------------------------------------------------
【如何运行（2 步）】
------------------------------------------------------------

1）安装依赖：

    pip install numpy matplotlib scipy pyyaml

2）在项目根目录运行：

    python run_pc_chip_pcm.py


------------------------------------------------------------
【参数描述】
------------------------------------------------------------

只需修改：

    configs/gd_demo.yaml

常用参数示例：

chip:
  pulse_s: 1.5e-8          整形后的信号脉宽
  delta_t_s: 1e-9          仿真时间步长
  integral_time_s: 4e-4    总积分时间
  Cf_F: 4e-14              积分电容
  noise_ENC: 330           等效噪声电荷

run:
  n_runs: 1
  show_plots: true         是否弹窗显示图

说明：
- 所有参数均可通过 YAML 控制，每次运行会自动保存配置快照 


------------------------------------------------------------
【运行结果】
------------------------------------------------------------

程序会自动生成：

results/实验名/时间戳/

常用输出文件包括：

Vint_prefilter.png
    积分节点电压（整形前），用于理解 pile-up 与积分行为

signals_full.png / signals_zoom.png
    芯片输出波形（时间域）

spectra.png
    积分谱 / 微分谱 / 二阶差分
    常用于能谱标定分析

integral_avg.npy / differential_avg.npy
    数值结果，方便后续算法处理

config_used.yaml
    本次运行的完整参数快照（强烈建议保留）


------------------------------------------------------------
【模型主要函数】
------------------------------------------------------------

    poisson_signal_generator_utils.py
    重点函数：
    - generate_signal
    - integrate_with_decay
    - shaper_cr_rc

    run_pc_chip_pcm.py
    重点函数：
    从 main() 函数顺着往下看即可。

 